select @Datetime := concat(date(curdate() - interval weekday(curdate()) + 7 day),' ','00:00:00');

INSERT IGNORE INTO poracleStats.controller (Datetime,RPL,DUmon,DUegg,DUraid,DUquest,DUinvasion,DUweather,DUnest,DUgym,DCmon,DCegg,DCraid,DCquest,DCinvasion,DCweather,DCnest,DCgym,DWmon,DWegg,DWraid,DWquest,DWinvasion,DWweather,DWnest,DWgym,TUmon,TUegg,TUraid,TUquest,TUinvasion,TUweather,TUnest,TUgym,TCmon,TCegg,TCraid,TCquest,TCinvasion,TCweather,TCnest,TCgym,TGmon,TGegg,TGraid,TGquest,TGinvasion,TGweather,TGnest,TGgym,minMsgSqlT,maxMsgSqlT,avgMsgSqlT,minMsgDtsT,maxMsgDtsT,avgMsgDtsT,minPvpT,maxPvpT,avgPvpT,rateLimit,minMsgT0,maxMsgT0,avgMsgT0,minPvpT0,maxPvpT0,avgPvpT0,noSend,minNomT,maxNomT,avgNomT,minTileT,maxTileT,avgTileT)
select
@Datetime,
'10080',
sum(DUmon),
sum(DUegg),
sum(DUraid),
sum(DUquest),
sum(DUinvasion),
sum(DUweather),
sum(DUnest),
sum(DUgym),
sum(DCmon),
sum(DCegg),
sum(DCraid),
sum(DCquest),
sum(DCinvasion),
sum(DCweather),
sum(DCnest),
sum(DCgym),
sum(DWmon),
sum(DWegg),
sum(DWraid),
sum(DWquest),
sum(DWinvasion),
sum(DWweather),
sum(DWnest),
sum(DWgym),
sum(TUmon),
sum(TUegg),
sum(TUraid),
sum(TUquest),
sum(TUinvasion),
sum(TUweather),
sum(TUnest),
sum(TUgym),
sum(TCmon),
sum(TCegg),
sum(TCraid),
sum(TCquest),
sum(TCinvasion),
sum(TCweather),
sum(TCnest),
sum(TCgym),
sum(TGmon),
sum(TGegg),
sum(TGraid),
sum(TGquest),
sum(TGinvasion),
sum(TGweather),
sum(TGnest),
sum(TGgym),
min(minMsgSqlT),
max(maxMsgSqlT),
avg(avgMsgSqlT),
min(minMsgDtsT),
max(maxMsgDtsT),
avg(avgMsgDtsT),
min(minPvpT),
max(maxPvpT),
avg(avgPvpT),
sum(rateLimit),
min(minMsgT0),
max(maxMsgT0),
avg(avgMsgT0),
min(minPvpT0),
max(maxPvpT0),
avg(avgPvpT0),
sum(noSend),
min(minNomT),
max(maxNomT),
avg(avgNomT),
min(minTileT),
max(maxTileT),
avg(avgTileT)
from poracleStats.controller
where Datetime >= date(curdate() - interval weekday(curdate()) + 7 day) and RPL = 1440
;

INSERT IGNORE INTO poracleStats.discord (Datetime,RPL,warn,error,errorBG,errorUA,errorCantSend,errorNoPerm,errorNoAccess,msgClean,msgSend,UmsgSend,CmsgSend,WmsgSend)
select
@Datetime,
'10080',
sum(warn),
sum(error),
sum(errorBG),
sum(errorUA),
sum(errorCantSend),
sum(errorNoPerm),
sum(errorNoAccess),
sum(msgClean),
sum(msgSend),
sum(UmsgSend),
sum(CmsgSend),
sum(WmsgSend)
from poracleStats.discord
where Datetime >= date(curdate() - interval weekday(curdate()) + 7 day) and RPL = 1440
;

INSERT IGNORE INTO poracleStats.telegram (Datetime,RPL,stickerFail,msgClean,msgSend,UmsgSend,CmsgSend,GmsgSend)
select
@Datetime,
'10080',
sum(stickerFail),
sum(msgClean),
sum(msgSend),
sum(UmsgSend),
sum(CmsgSend),
sum(GmsgSend)
from poracleStats.telegram
where Datetime >= date(curdate() - interval weekday(curdate()) + 7 day) and RPL = 1440
;

INSERT IGNORE INTO poracleStats.error (Datetime,RPL,warn,warnMap,warnRL,error,errorAddress)
select
@Datetime,
'10080',
sum(warn),
sum(warnMap),
sum(warnRL),
sum(error),
sum(errorAddress)
from poracleStats.error
where Datetime >= date(curdate() - interval weekday(curdate()) + 7 day) and RPL = 1440
;

INSERT INTO poracleStats.general (Datetime,RPL,whQinMinRaw,whQinMaxRaw,whQinAvgRaw,whQinMinWorker,whQinMaxWorker,whQinAvgWorker,whQoutMinDiscord,whQoutMaxDiscord,whQoutAvgDiscord,whQoutMinDiscordWH,whQoutMaxDiscordWH,whQoutAvgDiscordWH,whQoutMinTelegram,whQoutMaxTelegram,whQoutAvgTelegram,stopRL,stopUR,whReceived,whDiscarded,workerIn,poracleRes)
select
@Datetime,
'10080',
min(whQinMinRaw),
max(whQinMaxRaw),
avg(whQinAvgRaw),
min(whQinMinWorker),
max(whQinMaxWorker),
avg(whQinAvgWorker),
min(whQoutMinDiscord),
max(whQoutMaxDiscord),
avg(whQoutAvgDiscord),
min(whQoutMinDiscordWH),
max(whQoutMaxDiscordWH),
avg(whQoutAvgDiscordWH),
min(whQoutMinTelegram),
max(whQoutMaxTelegram),
avg(whQoutAvgTelegram),
sum(stopRL),
sum(stopUR),
sum(whReceived),
sum(whDiscarded),
sum(workerIn),
sum(poracleRes)
from poracleStats.general
where Datetime >= date(curdate() - interval weekday(curdate()) + 7 day) and RPL = 1440
;

INSERT IGNORE INTO poracleStats.middleman (Datetime,RPL,total,post200,post500)
select
@Datetime,
'10080',
sum(total),
sum(post200),
sum(post500)
from poracleStats.middleman
where Datetime >= date(curdate() - interval weekday(curdate()) + 7 day) and RPL = 1440
;

INSERT IGNORE INTO poracleStats.users (Datetime,RPL,id,name,type,msgSend,mon,egg,raid,quest,invasion,stopRL,stopUR,mnc)
select
@Datetime,
'10080',
id,
name,
type,
sum(msgSend),
sum(mon),
sum(egg),
sum(raid),
sum(quest),
sum(invasion),
sum(stopRL),
sum(stopUR),
sum(mnc)
from poracleStats.users
where Datetime >= date(curdate() - interval weekday(curdate()) + 7 day) and RPL = 1440
group by id
;
